# 日程代办提醒小程序开发文档

## 1. 小程序简介

### 1.1 项目概述
**日程代办提醒小程序**是一款基于微信小程序平台开发的个人任务管理应用，旨在帮助用户高效管理日常任务和项目，提供智能提醒功能，提升工作和生活效率。

### 1.2 核心特性
- **📅 日历视图**：直观的日历界面显示任务分布
- **✅ 任务管理**：支持周期性任务和一次性任务
- **📋 项目管理**：任务分组管理，进度跟踪
- **🏷️ 标签系统**：灵活的任务分类和自定义标签
- **⏰ 智能提醒**：多种提醒方式，包括应用内提醒和微信推送
- **📊 数据统计**：任务完成情况统计和分析

### 1.3 技术特点
- 基于微信小程序原生框架开发
- 采用本地存储实现数据持久化
- 集成微信订阅消息API实现推送通知
- 支持自定义标签和临时标签功能
- 响应式设计，适配不同屏幕尺寸

---

## 2. 需求分析

### 2.1 软件功能需求

#### 2.1.1 用户管理需求
- **用户身份识别**：通过微信授权获取用户openid
- **数据隔离**：每个用户的数据独立存储和管理
- **权限控制**：确保用户只能访问自己的数据

#### 2.1.2 任务管理需求
- **任务创建**：
  - 支持一次性任务和周期性任务
  - 任务基本信息：名称、描述、截止时间、优先级
  - 任务关联：可关联到具体项目
  - 标签管理：支持预定义标签和自定义临时标签

- **任务编辑**：
  - 修改任务所有属性
  - 任务状态管理（进行中、已完成、已删除）
  - 批量操作支持

- **任务查看**：
  - 日历视图：按日期显示任务分布
  - 列表视图：支持按优先级、日期排序
  - 筛选功能：按项目、标签、状态筛选

#### 2.1.3 项目管理需求
- **项目创建**：
  - 项目基本信息：名称、描述、截止时间、优先级
  - 项目状态管理：进行中、已完成

- **项目编辑**：
  - 修改项目所有属性
  - 项目进度计算（基于关联任务完成情况）

- **项目查看**：
  - 项目列表展示
  - 项目详情页面
  - 项目统计信息

#### 2.1.4 提醒功能需求
- **提醒设置**：
  - 可配置检查间隔（1分钟、3分钟、5分钟、10分钟）
  - 提醒方式选择（应用内提醒、微信推送）

- **提醒逻辑**：
  - 定时检查任务截止时间
  - 智能提醒算法（避免重复提醒）
  - 提醒历史记录

- **微信推送**：
  - 订阅消息授权
  - 模板消息发送
  - 推送状态管理

#### 2.1.5 数据管理需求
- **本地存储**：
  - 任务数据持久化
  - 项目数据持久化
  - 用户设置持久化
  - 数据备份和恢复

- **数据同步**：
  - 与后端服务数据同步
  - 多设备数据一致性
  - 离线数据支持

### 2.2 软件操作流程

#### 2.2.1 用户首次使用流程
```
1. 打开小程序
2. 授权获取用户信息
3. 初始化本地存储
4. 进入首页（日历视图）
5. 引导用户创建第一个任务或项目
```

#### 2.2.2 任务管理流程
```
创建任务：
1. 点击"+"按钮或进入任务页面
2. 填写任务基本信息
3. 选择任务类型（一次性/周期性）
4. 设置截止时间和优先级
5. 选择关联项目（可选）
6. 添加标签（预定义或自定义）
7. 保存任务

编辑任务：
1. 进入任务列表或详情页面
2. 点击编辑按钮
3. 修改任务信息
4. 保存修改

完成任务：
1. 在任务列表中点击完成按钮
2. 任务状态更新为已完成
3. 关联项目进度自动更新
```

#### 2.2.3 项目管理流程
```
创建项目：
1. 进入项目页面
2. 点击"新建项目"按钮
3. 填写项目基本信息
4. 设置项目截止时间和优先级
5. 保存项目

编辑项目：
1. 进入项目列表或详情页面
2. 点击编辑按钮
3. 修改项目信息
4. 保存修改

查看项目进度：
1. 进入项目详情页面
2. 查看关联任务列表
3. 查看项目完成进度
4. 查看项目统计信息
```

#### 2.2.4 提醒设置流程
```
设置提醒：
1. 进入提醒设置页面
2. 选择检查间隔
3. 开启/关闭提醒功能
4. 授权微信推送通知
5. 保存设置

接收提醒：
1. 系统定时检查任务
2. 发现即将到期的任务
3. 显示应用内提醒弹窗
4. 发送微信推送通知（如果已授权）
```

---

## 3. 技术路线

### 3.1 需要具备的知识

#### 3.1.1 前端开发知识
- **微信小程序开发**：
  - 小程序框架基础（App、Page、Component）
  - WXML模板语法和组件使用
  - WXSS样式编写和布局
  - JavaScript ES6+语法
  - 小程序生命周期管理

- **前端基础技术**：
  - HTML/CSS基础
  - JavaScript异步编程（Promise、async/await）
  - 数据绑定和事件处理
  - 本地存储API使用

#### 3.1.2 后端开发知识
- **Node.js开发**：
  - Express框架使用
  - RESTful API设计
  - 中间件使用（CORS、body-parser）
  - 定时任务调度（node-cron）

- **微信API集成**：
  - 微信登录API
  - 订阅消息API
  - 模板消息发送
  - 微信服务器验证

#### 3.1.3 数据库知识
- **数据存储**：
  - JSON文件存储
  - 数据序列化和反序列化
  - 数据查询和更新操作

#### 3.1.4 部署运维知识
- **服务器部署**：
  - 云服务器配置
  - 域名和SSL证书配置
  - 反向代理设置
  - 进程管理（PM2）

### 3.2 编译环境

#### 3.2.1 开发环境要求
- **操作系统**：Windows 10/11、macOS、Linux
- **开发工具**：
  - 微信开发者工具（最新版本）
  - Visual Studio Code（推荐）
  - Node.js 16.0+ 
  - npm 8.0+

#### 3.2.2 小程序开发环境
```json
{
  "miniprogramRoot": "./",
  "projectname": "ddl",
  "setting": {
    "urlCheck": false,
    "es6": true,
    "enhance": true,
    "postcss": true,
    "preloadBackgroundData": false,
    "minified": true,
    "newFeature": false,
    "coverView": true,
    "nodeModules": false,
    "autoAudits": false,
    "showShadowRootInWxmlPanel": true,
    "scopeDataCheck": false,
    "uglifyFileName": false,
    "checkInvalidKey": true,
    "checkSiteMap": true,
    "uploadWithSourceMap": true,
    "compileHotReLoad": false,
    "lazyloadPlaceholderEnable": false,
    "useMultiFrameRuntime": true,
    "useApiHook": true,
    "useApiHostProcess": true,
    "babelSetting": {
      "ignore": [],
      "disablePlugins": [],
      "outputPath": ""
    },
    "enableEngineNative": false,
    "useIsolateContext": true,
    "userConfirmedBundleSwitch": false,
    "packNpmManually": false,
    "packNpmRelationList": [],
    "minifyWXSS": true,
    "disableUseStrict": false,
    "minifyWXML": true,
    "showES6CompileOption": false,
    "useCompilerPlugins": false
  }
}
```

#### 3.2.3 后端开发环境
```json
{
  "name": "wechat-reminder-backend",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.2",
    "axios": "^1.6.0",
    "node-cron": "^3.0.3",
    "cors": "^2.8.5",
    "body-parser": "^1.20.2"
  }
}
```

#### 3.2.4 环境配置步骤
1. **安装微信开发者工具**
2. **安装Node.js和npm**
3. **克隆项目代码**
4. **安装依赖**：`npm install`
5. **配置小程序AppID**
6. **启动后端服务**：`npm start`
7. **在微信开发者工具中打开项目**

---

## 4. 程序设计

### 4.1 软件逻辑架构

#### 4.1.1 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    微信小程序前端                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   首页模块   │  │   任务模块   │  │   项目模块   │        │
│  │  (index)    │  │   (tasks)   │  │  (projects) │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │  任务管理    │  │  项目管理    │  │  提醒设置    │        │
│  │ (add-task)  │  │(new-project)│  │(reminder)   │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
├─────────────────────────────────────────────────────────────┤
│                   全局应用逻辑 (app.js)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │  数据管理    │  │  提醒逻辑    │  │  工具函数    │        │
│  │ (Storage)   │  │ (Reminder)  │  │  (Utils)    │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    后端服务 (Node.js)                       │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │  Express    │  │   定时任务   │  │  微信API     │        │
│  │   服务器     │  │  (Cron)     │  │ 集成服务     │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   用户管理   │  │   订阅管理   │  │   消息推送   │        │
│  │  (Users)    │  │(Subscribe)  │  │ (Notification)│       │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据存储层                               │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   本地存储   │  │   JSON文件   │  │   微信云存储  │        │
│  │ (wx.storage)│  │  (Backend)  │  │  (Optional) │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

#### 4.1.2 模块划分
- **前端模块**：
  - 首页模块：日历视图、任务概览
  - 任务模块：任务列表、任务详情、任务编辑
  - 项目模块：项目列表、项目详情、项目编辑
  - 提醒模块：提醒设置、订阅管理

- **后端模块**：
  - 用户管理：openid获取、用户数据管理
  - 订阅管理：订阅消息授权、状态管理
  - 消息推送：模板消息发送、推送状态跟踪
  - 定时任务：提醒检查、数据同步

### 4.2 核心代码解析

#### 4.2.1 应用入口 (app.js)
```javascript
// 应用生命周期管理
App({
  onLaunch() {
    this.initStorage()        // 初始化本地存储
    this.startReminderCheck() // 启动提醒检查
  },
  
  onShow() {
    this.startReminderCheck() // 应用显示时启动提醒
  },
  
  onHide() {
    this.stopReminderCheck()  // 应用隐藏时停止提醒
  }
})
```

**核心功能**：
- 全局数据管理
- 提醒系统控制
- 工具函数提供
- 微信API集成

#### 4.2.2 提醒系统核心逻辑
```javascript
// 提醒检查逻辑
checkReminders() {
  const tasks = wx.getStorageSync('tasks') || []
  const now = new Date()
  
  tasks.forEach(task => {
    if (task.completed || !task.deadline) return
    
    const deadline = new Date(task.deadline)
    const timeDiff = deadline.getTime() - now.getTime()
    
    // 检查是否需要提醒
    if (timeDiff <= this.data.reminderInterval * 60 * 1000 && timeDiff > 0) {
      this.showInAppReminder(task)
      this.sendWechatNotification(task)
    }
  })
}
```

**关键特性**：
- 定时检查任务截止时间
- 智能提醒算法
- 多种提醒方式支持
- 避免重复提醒

#### 4.2.3 数据管理核心
```javascript
// 任务数据管理
saveTask(taskData) {
  const tasks = wx.getStorageSync('tasks') || []
  const taskId = taskData.id || Date.now().toString()
  
  const task = {
    id: taskId,
    name: taskData.name,
    type: taskData.type,
    details: taskData.details,
    deadline: taskData.deadline,
    cycle: taskData.cycle,
    priority: taskData.priority,
    projectId: taskData.projectId,
    tags: taskData.tags,
    completed: false,
    createdAt: new Date().toISOString()
  }
  
  // 更新或添加任务
  const existingIndex = tasks.findIndex(t => t.id === taskId)
  if (existingIndex >= 0) {
    tasks[existingIndex] = task
  } else {
    tasks.push(task)
  }
  
  wx.setStorageSync('tasks', tasks)
  return task
}
```

**数据特点**：
- 本地存储优先
- 数据版本控制
- 关联数据同步
- 错误处理机制

#### 4.2.4 微信API集成
```javascript
// 获取用户openid
getUserOpenId() {
  return new Promise((resolve, reject) => {
    wx.login({
      success: (res) => {
        if (res.code) {
          wx.request({
            url: 'https://your-backend-domain.com/api/get-openid',
            method: 'POST',
            data: { code: res.code },
            success: (response) => {
              if (response.data.success) {
                resolve(response.data.openid)
              } else {
                reject(new Error('获取openid失败'))
              }
            },
            fail: reject
          })
        } else {
          reject(new Error('微信登录失败'))
        }
      },
      fail: reject
    })
  })
}
```

**集成特点**：
- 异步处理
- 错误处理
- 状态管理
- 用户体验优化

#### 4.2.5 后端服务核心
```javascript
// Express服务器配置
const express = require('express')
const cors = require('cors')
const bodyParser = require('body-parser')
const cron = require('node-cron')

const app = express()

// 中间件配置
app.use(cors())
app.use(bodyParser.json())

// 获取用户openid
app.post('/api/get-openid', async (req, res) => {
  try {
    const { code } = req.body
    const response = await axios.get(`https://api.weixin.qq.com/sns/jscode2session`, {
      params: {
        appid: WECHAT_APPID,
        secret: WECHAT_SECRET,
        js_code: code,
        grant_type: 'authorization_code'
      }
    })
    
    res.json({
      success: true,
      openid: response.data.openid
    })
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    })
  }
})

// 定时任务：检查提醒
cron.schedule('* * * * *', () => {
  checkAndSendReminders()
})
```

**服务特点**：
- RESTful API设计
- 定时任务调度
- 微信API集成
- 错误处理和日志

---

## 5. 测试与部署

### 5.1 测试策略

#### 5.1.1 功能测试
- **任务管理测试**：
  - 任务创建、编辑、删除功能
  - 任务状态更新和同步
  - 任务筛选和排序功能

- **项目管理测试**：
  - 项目创建、编辑、删除功能
  - 项目进度计算准确性
  - 项目与任务关联性

- **提醒功能测试**：
  - 提醒设置保存和加载
  - 定时提醒触发准确性
  - 微信推送消息发送

#### 5.1.2 兼容性测试
- **设备兼容性**：
  - 不同屏幕尺寸适配
  - 不同操作系统版本
  - 不同微信版本

- **性能测试**：
  - 大量数据加载性能
  - 内存使用情况
  - 响应时间测试

#### 5.1.3 用户体验测试
- **界面测试**：
  - 界面元素显示正确性
  - 交互反馈及时性
  - 错误提示友好性

- **流程测试**：
  - 用户操作流程完整性
  - 异常情况处理
  - 数据一致性保证

### 5.2 部署方案

#### 5.2.1 小程序部署
1. **开发环境测试**：
   - 微信开发者工具调试
   - 真机预览测试
   - 功能完整性验证

2. **生产环境部署**：
   - 代码压缩和优化
   - 上传到微信公众平台
   - 提交审核和发布

#### 5.2.2 后端服务部署

**方案一：ngrok（测试环境）**
```bash
# 1. 下载ngrok
# 2. 注册账号获取authtoken
ngrok config add-authtoken YOUR_AUTHTOKEN

# 3. 启动后端服务
cd wechat-reminder-backend
node app.js

# 4. 启动ngrok隧道
ngrok http 3000

# 5. 获取公网地址并更新小程序配置
```

**方案二：云服务器（生产环境）**
```bash
# 1. 购买云服务器（推荐腾讯云轻量应用服务器）
# 2. 安装Node.js环境
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 3. 部署后端代码
scp -r wechat-reminder-backend/ user@your-server:/home/user/
cd wechat-reminder-backend
npm install

# 4. 配置进程管理
npm install -g pm2
pm2 start app.js --name "wechat-reminder"

# 5. 配置反向代理（Nginx）
sudo apt-get install nginx
# 配置Nginx配置文件
sudo nano /etc/nginx/sites-available/wechat-reminder
# 启用站点
sudo ln -s /etc/nginx/sites-available/wechat-reminder /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# 6. 配置SSL证书
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

#### 5.2.3 域名和SSL配置
1. **域名购买**：在腾讯云或阿里云购买域名
2. **DNS解析**：将域名解析到服务器IP
3. **SSL证书**：使用Let's Encrypt免费证书
4. **HTTPS配置**：确保所有API使用HTTPS

#### 5.2.4 监控和维护
1. **日志监控**：
   - 应用日志记录
   - 错误日志分析
   - 性能监控

2. **数据备份**：
   - 定期备份用户数据
   - 数据库备份策略
   - 灾难恢复计划

3. **安全维护**：
   - 定期更新依赖包
   - 安全漏洞扫描
   - 访问权限控制

### 5.3 发布流程

#### 5.3.1 小程序发布流程
1. **代码准备**：
   - 功能测试完成
   - 代码审查通过
   - 版本号更新

2. **上传审核**：
   - 微信开发者工具上传
   - 填写版本信息
   - 提交审核

3. **审核发布**：
   - 等待微信审核
   - 审核通过后发布
   - 用户可正常使用

#### 5.3.2 后端服务发布流程
1. **服务准备**：
   - 代码测试完成
   - 配置文件更新
   - 依赖包安装

2. **服务部署**：
   - 停止旧服务
   - 部署新代码
   - 启动新服务

3. **服务验证**：
   - 健康检查
   - 功能测试
   - 性能监控

---

## 6. 总结

### 6.1 项目亮点
- **用户体验优秀**：直观的日历界面，简洁的操作流程
- **功能完整**：涵盖任务管理、项目管理、智能提醒等核心功能
- **技术先进**：采用微信小程序原生框架，集成微信API
- **扩展性强**：模块化设计，易于功能扩展和维护

### 6.2 技术价值
- **学习价值**：完整的微信小程序开发案例
- **实用价值**：可直接用于个人任务管理
- **商业价值**：具备商业化运营的基础

### 6.3 后续优化方向
- **功能优化**：添加更多提醒方式，支持团队协作
- **性能优化**：优化大数据量处理，提升响应速度
- **体验优化**：增加个性化设置，优化界面交互
- **技术升级**：考虑迁移到云开发，提升可扩展性

---

*本文档版本：v1.0*  
*最后更新：2024年12月*  
*文档作者：开发团队*
