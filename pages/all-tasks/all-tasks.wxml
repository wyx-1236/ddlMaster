<!--pages/all-tasks/all-tasks.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view>
      <text class="header-title">å…¨éƒ¨ä»»åŠ¡</text>
    </view>
    <view class="header-actions">
      <view class="sort-btn" bindtap="toggleSortType">
        {{sortType === 'deadline' ? 'æŒ‰ä¼˜å…ˆçº§' : 'æŒ‰æ—¥æœŸ'}}
      </view>
      <view class="edit-btn" bindtap="toggleEditMode">
        {{isEditing ? 'å®Œæˆ' : 'ç¼–è¾‘'}}
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡ç»Ÿè®¡ -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-number">{{totalTasks}}</text>
      <text class="stat-label">æ€»ä»»åŠ¡</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{uncompletedTasks}}</text>
      <text class="stat-label">æœªå®Œæˆ</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{completedTasks}}</text>
      <text class="stat-label">å·²å®Œæˆ</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{completionRate}}%</text>
      <text class="stat-label">å®Œæˆç‡</text>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="card">
    <view wx:if="{{allTasks.length === 0}}" class="empty-state">
      <text class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•ä»»åŠ¡</text>
    </view>
    <view 
      wx:for="{{allTasks}}" 
      wx:key="id"
      class="task-item {{item.completed ? 'completed-task' : ''}}"
      style="background: {{item.priorityBgColor}};"
    >
      <view 
        class="task-checkbox {{item.completed ? 'completed' : ''}}"
        bindtap="completeTask"
        data-id="{{item.id}}"
      >
        <text wx:if="{{item.completed}}">âœ“</text>
      </view>
      <view class="task-content">
        <view class="task-header">
          <view class="task-name">{{item.name}}</view>
          <view class="task-project" wx:if="{{item.projectName}}">
            <text class="project-label">ğŸ“ {{item.projectName}}</text>
          </view>
          <view class="task-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <view 
              wx:for="{{item.tags}}" 
              wx:key="*this"
              wx:for-item="tagId"
              class="task-tag"
              style="background: {{item.tagColors[tagId]}};"
            >
              <text class="tag-icon">{{item.tagIcons[tagId]}}</text>
              <text class="tag-name">{{item.tagNames[tagId]}}</text>
            </view>
          </view>
        </view>
        <view class="task-deadline" wx:if="{{item.type === 'periodic'}}">
          æˆªæ­¢æ—¶é—´ï¼š{{item.deadline}} {{item.deadlineTime}}
        </view>
        <view class="task-cycle-info" wx:if="{{item.type === 'cycle'}}">
          <view class="cycle-date-range">å‘¨æœŸï¼š{{item.startDate}} è‡³ {{item.endDate}}</view>
          <view class="cycle-progress" wx:if="{{item.cycleStats}}">
            å®Œæˆè¿›åº¦ï¼š{{item.cycleStats.completedDates}}/{{item.cycleStats.totalDates}} ({{item.cycleStats.completionRate}}%)
          </view>
        </view>
        <view class="task-details" wx:if="{{item.details}}">{{item.details}}</view>
        <view class="task-status">
          <text class="status-text {{item.completed ? 'completed' : ''}}">
            {{item.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}}
          </text>
        </view>
      </view>
      <view class="tag tag-{{item.type}}">
        {{item.type === 'cycle' ? (item.cycleValue + (item.cycleType === 'days' ? 'å¤©' : 'å‘¨')) : (item.type === 'periodic' ? 'å®šæœŸ' : 'æ¯æ—¥')}}
      </view>
      <view class="task-actions" wx:if="{{isEditing}}">
        <view class="action-btn edit" bindtap="editTask" data-id="{{item.id}}">ç¼–è¾‘</view>
        <view class="action-btn delete" bindtap="deleteTask" data-id="{{item.id}}">åˆ é™¤</view>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="addTask">+</view>
</view>
