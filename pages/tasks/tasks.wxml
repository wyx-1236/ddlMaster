<!--pages/tasks/tasks.wxml-->
<view class="container">


  <!-- æœªå®Œæˆä»»åŠ¡æ¿å— -->
  <view class="card" wx:if="{{uncompletedTasks.length > 0}}">
    <view class="title">
      æœªå®Œæˆä»»åŠ¡
      <view class="edit-btn" bindtap="toggleEditMode">
        {{isEditing ? 'å®Œæˆ' : 'ç¼–è¾‘'}}
      </view>
    </view>
    <view 
      wx:for="{{uncompletedTasks}}" 
      wx:key="id"
      class="task-item"
      style="background: {{item.priorityBgColor}};"
    >
      <view 
        class="task-checkbox {{item.completed ? 'completed' : ''}}"
        bindtap="completeTask"
        data-id="{{item.id}}"
      >
        <text wx:if="{{item.completed}}">âœ“</text>
      </view>
      <view class="task-content">
        <view class="task-header">
          <view class="task-name">{{item.name}}</view>
          <view class="task-project" wx:if="{{item.projectName}}">
            <text class="project-label">ğŸ“ {{item.projectName}}</text>
          </view>
          <view class="task-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <view 
              wx:for="{{item.tags}}" 
              wx:key="*this"
              wx:for-item="tagId"
              class="task-tag"
              style="background: {{item.tagColors[tagId]}};"
            >
              <text class="tag-icon">{{item.tagIcons[tagId]}}</text>
              <text class="tag-name">{{item.tagNames[tagId]}}</text>
            </view>
          </view>
        </view>
        <view class="task-deadline" wx:if="{{item.type === 'periodic'}}">
          æˆªæ­¢æ—¶é—´ï¼š{{item.deadline}} {{item.deadlineTime}}
        </view>
        <view class="task-cycle-info" wx:if="{{item.type === 'cycle'}}">
          <view class="cycle-date-range">å‘¨æœŸï¼š{{item.startDate}} è‡³ {{item.endDate}}</view>
          <view class="cycle-progress" wx:if="{{item.cycleStats}}">
            å®Œæˆè¿›åº¦ï¼š{{item.cycleStats.completedDates}}/{{item.cycleStats.totalDates}} ({{item.cycleStats.completionRate}}%)
          </view>
        </view>
        <view class="task-details" wx:if="{{item.details}}">{{item.details}}</view>
      </view>
      <view class="tag tag-{{item.type}}">
        {{item.type === 'cycle' ? (item.cycleValue + (item.cycleType === 'days' ? 'å¤©' : 'å‘¨')) : (item.type === 'periodic' ? 'å®šæœŸ' : 'æ¯æ—¥')}}
      </view>
      <view class="task-actions" wx:if="{{isEditing}}">
        <view class="action-btn edit-btn" bindtap="editTask" data-id="{{item.id}}">
          ç¼–è¾‘
        </view>
        <view class="action-btn delete-btn" bindtap="deleteTask" data-id="{{item.id}}">
          åˆ é™¤
        </view>
      </view>
    </view>
  </view>

  <!-- å…¨éƒ¨ä»»åŠ¡æ¿å— - å¯ç‚¹å‡»è·³è½¬ -->
  <view class="card clickable-card" bindtap="goToAllTasks">
    <view class="title">
      å…¨éƒ¨ä»»åŠ¡
      <view class="arrow-icon">â†’</view>
    </view>
    <view class="task-summary">
      <text class="summary-text">å…± {{allTasks.length}} ä¸ªä»»åŠ¡</text>
      <text class="summary-text">å·²å®Œæˆ {{completedTasksCount}} ä¸ª</text>
    </view>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="addTask">+</view>
</view>
