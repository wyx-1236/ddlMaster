<!--pages/edit-task/edit-task.wxml-->
<view class="container">
  <view class="header">
    <text class="title">ç¼–è¾‘ä»»åŠ¡</text>
  </view>

  <view class="form">
    <!-- ä»»åŠ¡åç§° -->
    <view class="form-group">
      <text class="label">ä»»åŠ¡åç§° *</text>
      <input 
        class="input" 
        placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°" 
        value="{{taskName}}"
        bindinput="onNameInput"
        maxlength="50"
      />
    </view>

    <!-- ä»»åŠ¡ç±»å‹ -->
    <view class="form-group">
      <text class="label">ä»»åŠ¡ç±»å‹</text>
      <picker 
        mode="selector" 
        range="{{typeNames}}" 
        value="{{typeIndex}}"
        bindchange="onTypeChange"
      >
        <view class="picker">
          <text class="picker-text">{{typeNames[typeIndex]}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <!-- ä»»åŠ¡æè¿° -->
    <view class="form-group">
      <text class="label">ä»»åŠ¡æè¿°</text>
      <textarea 
        class="textarea" 
        placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰" 
        value="{{taskDetails}}"
        bindinput="onDetailsInput"
        maxlength="200"
        auto-height
      />
    </view>

    <!-- å®šæœŸä»»åŠ¡ï¼šæˆªæ­¢æ—¥æœŸå’Œæ—¶é—´ -->
    <view class="form-group" wx:if="{{taskType === 'periodic'}}">
      <text class="label">æˆªæ­¢æ—¥æœŸ *</text>
      <picker 
        mode="date" 
        value="{{taskDeadline}}" 
        bindchange="onDeadlineChange"
        start="{{today}}"
      >
        <view class="picker">
          <text class="picker-text">{{taskDeadline || 'è¯·é€‰æ‹©æˆªæ­¢æ—¥æœŸ'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <view class="form-group" wx:if="{{taskType === 'periodic'}}">
      <text class="label">æˆªæ­¢æ—¶é—´</text>
      <picker 
        mode="time" 
        value="{{taskDeadlineTime}}" 
        bindchange="onDeadlineTimeChange"
      >
        <view class="picker">
          <text class="picker-text">{{taskDeadlineTime || 'è¯·é€‰æ‹©æˆªæ­¢æ—¶é—´'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <!-- å‘¨æœŸä»»åŠ¡ï¼šå‘¨æœŸè®¾ç½® -->
    <view class="form-group" wx:if="{{taskType === 'cycle'}}">
      <text class="label">å‘¨æœŸè®¾ç½® *</text>
      <view class="cycle-settings">
        <text class="cycle-text">æ¯</text>
        <input 
          class="cycle-input" 
          type="number" 
          value="{{cycleValue}}"
          bindinput="onCycleValueInput"
          placeholder="1"
        />
        <picker 
          mode="selector" 
          range="{{cycleTypeNames}}" 
          value="{{cycleTypeIndex}}"
          bindchange="onCycleTypeChange"
        >
          <view class="cycle-picker">
            <text class="cycle-picker-text">{{cycleTypeNames[cycleTypeIndex]}}</text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
    </view>

    <view class="form-group" wx:if="{{taskType === 'cycle'}}">
      <text class="label">å¼€å§‹æ—¥æœŸ *</text>
      <picker 
        mode="date" 
        value="{{startDate}}" 
        bindchange="onStartDateChange"
        start="{{today}}"
      >
        <view class="picker">
          <text class="picker-text">{{startDate || 'è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <view class="form-group" wx:if="{{taskType === 'cycle'}}">
      <text class="label">ç»“æŸæ—¥æœŸ *</text>
      <picker 
        mode="date" 
        value="{{endDate}}" 
        bindchange="onEndDateChange"
        start="{{startDate || today}}"
      >
        <view class="picker">
          <text class="picker-text">{{endDate || 'è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <!-- ä¼˜å…ˆçº§ -->
    <view class="form-group">
      <text class="label">ä¼˜å…ˆçº§</text>
      <picker 
        mode="selector" 
        range="{{priorityOptions}}" 
        range-key="name"
        value="{{priorityIndex}}"
        bindchange="onPriorityChange"
      >
        <view class="picker">
          <text class="picker-text">{{priorityOptions[priorityIndex].name}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <!-- å…³è”é¡¹ç›® -->
    <view class="form-group">
      <text class="label">å…³è”é¡¹ç›®</text>
      <picker 
        mode="selector" 
        range="{{projects}}" 
        range-key="name"
        value="{{projectIndex}}"
        bindchange="onProjectChange"
      >
        <view class="picker">
          <text class="picker-text">{{taskProjectName || 'è¯·é€‰æ‹©é¡¹ç›®ï¼ˆå¯é€‰ï¼‰'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <!-- æ ‡ç­¾é€‰æ‹© -->
    <view class="form-group">
      <text class="label">æ ‡ç­¾</text>
      <view class="tags-container">
        <view 
          class="tag-item {{selectedTags.indexOf(item.id) > -1 ? 'selected' : ''}}"
          wx:for="{{tags}}"
          wx:key="id"
          bindtap="toggleTag"
          data-tag-id="{{item.id}}"
        >
          <text class="tag-icon">{{item.icon}}</text>
          <text class="tag-name">{{item.name}}</text>
        </view>
        
        <!-- è‡ªå®šä¹‰æ ‡ç­¾æŒ‰é’® -->
        <view class="tag-item custom-tag-btn" bindtap="showCustomTagInput">
          <text class="tag-icon">ğŸ“</text>
          <text class="tag-name">è‡ªå®šä¹‰</text>
        </view>
      </view>
      
      <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
      <view class="custom-tag-input" wx:if="{{showCustomTagInput}}">
        <view class="input-group">
          <input 
            class="custom-tag-name-input" 
            placeholder="è¯·è¾“å…¥æ ‡ç­¾åç§°" 
            value="{{customTagName}}"
            bindinput="onCustomTagNameInput"
            maxlength="10"
          />
          <view class="custom-tag-actions">
            <button class="action-btn cancel" bindtap="hideCustomTagInput">å–æ¶ˆ</button>
            <button class="action-btn confirm" bindtap="addCustomTag">æ·»åŠ </button>
          </view>
        </view>
      </view>
      
      <!-- å·²é€‰æ ‡ç­¾æ˜¾ç¤º -->
      <view class="selected-tags" wx:if="{{selectedTagNames}}">
        <text class="selected-tags-text">{{selectedTagNames}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="actions">
    <button class="btn btn-danger" bindtap="deleteTask">åˆ é™¤ä»»åŠ¡</button>
    <button class="btn btn-primary" bindtap="saveTask">ä¿å­˜ä¿®æ”¹</button>
  </view>
</view>



