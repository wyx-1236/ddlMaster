<!--pages/index/index.wxml-->
<view class="container">
  <!-- æ—¥å†æ¿å— -->
  <view class="calendar">
    <view class="calendar-header">
      <view class="calendar-title">
        {{currentYear}}å¹´{{currentMonth}}æœˆ
      </view>
      <view class="calendar-nav">
        <view class="calendar-nav-btn" bindtap="prevMonth">â€¹</view>
        <view class="calendar-nav-btn" bindtap="nextMonth">â€º</view>
        <view class="reminder-settings-btn" bindtap="goToReminderSettings">ğŸ””</view>
      </view>
    </view>
    
    <view class="calendar-grid">
      <!-- æ˜ŸæœŸæ ‡é¢˜ -->
      <view class="calendar-weekday" wx:for="{{weekdays}}" wx:key="*this">
        {{item}}
      </view>
      
      <!-- æ—¥æœŸæ ¼å­ -->
      <view 
        wx:for="{{calendarDays}}" 
        wx:key="index"
        class="calendar-day {{item.isToday ? 'today' : ''}} {{item.isSelected ? 'selected' : ''}} {{item.hasTasks ? 'has-tasks' : ''}} {{!item.isCurrentMonth ? 'other-month' : ''}} {{item.isWeekend ? 'isWeekend' : ''}}"
        bindtap="selectDate"
        data-index="{{index}}"
      >
        {{item.day}}
      </view>
    </view>
  </view>

  <!-- é€‰ä¸­æ—¥æœŸä»»åŠ¡æ¿å— -->
  <view class="card">
    <view class="title">
      <block wx:if="{{isSelectedToday}}">
        ä»Šæ—¥ä»»åŠ¡
      </block>
      <block wx:else>
        {{selectedMonth}}æœˆ{{selectedDay}}æ—¥çš„ä»»åŠ¡
      </block>
      <view class="date-info" wx:if="{{selectedDate}}">
        {{selectedYear}}å¹´{{selectedMonth}}æœˆ{{selectedDay}}æ—¥
        <text wx:if="{{selectedDate.getDay() === 0 || selectedDate.getDay() === 6}}" class="weekend-mark">å‘¨æœ«</text>
      </view>
    </view>
    <view wx:if="{{todayTasks.length === 0}}" style="text-align: center; color: #999; padding: 40rpx 0;">
      è¿™ä¸€å¤©æ²¡æœ‰ä»»åŠ¡å®‰æ’
    </view>
    <view 
      wx:for="{{todayTasks}}" 
      wx:key="id"
      class="task-item"
      style="background: {{item.priorityBgColor}};"
    >
      <view 
        class="task-checkbox {{item.completed ? 'completed' : ''}}"
        bindtap="completeTask"
        data-id="{{item.id}}"
      >
        <text wx:if="{{item.completed}}">âœ“</text>
      </view>
      <view class="task-content">
        <view class="task-header">
          <view class="task-name">{{item.name}}</view>
          <view class="task-project" wx:if="{{item.projectName}}">
            <text class="project-label">ğŸ“ {{item.projectName}}</text>
          </view>
          <view class="task-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <view 
              wx:for="{{item.tags}}" 
              wx:key="*this"
              wx:for-item="tagId"
              class="task-tag"
              style="background: {{item.tagColors[tagId]}};"
            >
              <text class="tag-icon">{{item.tagIcons[tagId]}}</text>
              <text class="tag-name">{{item.tagNames[tagId]}}</text>
            </view>
          </view>
        </view>
        <view class="task-deadline" wx:if="{{item.type === 'periodic'}}">
          æˆªæ­¢æ—¶é—´ï¼š{{item.deadline}} {{item.deadlineTime}}
        </view>
        <view class="task-cycle-info" wx:if="{{item.type === 'cycle'}}">
          <view class="cycle-date-range">å‘¨æœŸï¼š{{item.startDate}} è‡³ {{item.endDate}}</view>
          <view class="cycle-progress" wx:if="{{item.cycleStats}}">
            å®Œæˆè¿›åº¦ï¼š{{item.cycleStats.completedDates}}/{{item.cycleStats.totalDates}} ({{item.cycleStats.completionRate}}%)
          </view>
        </view>
        <view class="task-details" wx:if="{{item.details}}">{{item.details}}</view>
      </view>
      <view class="tag tag-{{item.type}}">
        {{item.type === 'periodic' ? 'å®šæœŸ' : 'æ¯æ—¥'}}
      </view>
    </view>
  </view>

  <!-- æ‹–æ¬ ä»»åŠ¡æ¿å— -->
  <view class="card" wx:if="{{overdueTasks.length > 0}}">
    <view class="title">æ‹–æ¬ ä»»åŠ¡</view>
    <view 
      wx:for="{{overdueTasks}}" 
      wx:key="id"
      class="task-item"
      style="background: {{item.priorityBgColor}};"
    >
      <view 
        class="task-checkbox {{item.completed ? 'completed' : ''}}"
        bindtap="completeTask"
        data-id="{{item.id}}"
      >
        <text wx:if="{{item.completed}}">âœ“</text>
      </view>
      <view class="task-content">
        <view class="task-header">
          <view class="task-name">{{item.name}}</view>
          <view class="task-project" wx:if="{{item.projectName}}">
            <text class="project-label">ğŸ“ {{item.projectName}}</text>
          </view>
          <view class="task-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <view 
              wx:for="{{item.tags}}" 
              wx:key="*this"
              wx:for-item="tagId"
              class="task-tag"
              style="background: {{item.tagColors[tagId]}};"
            >
              <text class="tag-icon">{{item.tagIcons[tagId]}}</text>
              <text class="tag-name">{{item.tagNames[tagId]}}</text>
            </view>
          </view>
        </view>
        <view class="task-deadline" wx:if="{{item.type === 'periodic'}}">
          æˆªæ­¢æ—¶é—´ï¼š{{item.deadline}} {{item.deadlineTime}}
        </view>
        <view class="task-details" wx:if="{{item.details}}">{{item.details}}</view>
      </view>
      <view class="tag tag-{{item.type}}">
        {{item.type === 'periodic' ? 'å®šæœŸ' : 'æ¯æ—¥'}}
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="addTask">+</view>
</view>
